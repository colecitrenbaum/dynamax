Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# Plot predictions from a random, untrained model
init_key, hmc_key = jr.split(jr.PRNGKey(42))
model = LinearGaussianConjugateSSM(state_dim, emission_dim)
params, param_props = model.initialize(init_key)

sample_size = 1000
param_samples, lps = fit_hmc(model, 
                             params, 
                             param_props, 
                             hmc_key, 
                             sample_size, 
                             emissions, 
                             num_integration_steps=5,
                             warmup_steps=10)
------------------

----- stdout -----
Running window adaptation
------------------

[31m---------------------------------------------------------------------------[39m
[31mTypeError[39m                                 Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[9][39m[32m, line 7[39m
[32m      4[39m params, param_props = model.initialize(init_key)
[32m      6[39m sample_size = [32m1000[39m
[32m----> [39m[32m7[39m param_samples, lps = [43mfit_hmc[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m
[32m      8[39m [43m                             [49m[43mparams[49m[43m,[49m[43m [49m
[32m      9[39m [43m                             [49m[43mparam_props[49m[43m,[49m[43m [49m
[32m     10[39m [43m                             [49m[43mhmc_key[49m[43m,[49m[43m [49m
[32m     11[39m [43m                             [49m[43msample_size[49m[43m,[49m[43m [49m
[32m     12[39m [43m                             [49m[43memissions[49m[43m,[49m[43m [49m
[32m     13[39m [43m                             [49m[43mnum_integration_steps[49m[43m=[49m[32;43m5[39;49m[43m,[49m
[32m     14[39m [43m                             [49m[43mwarmup_steps[49m[43m=[49m[32;43m10[39;49m[43m)[49m

[36mCell[39m[36m [39m[32mIn[8][39m[32m, line 32[39m, in [36mfit_hmc[39m[34m(model, initial_params, props, key, num_samples, emissions, inputs, warmup_steps, num_integration_steps, verbose)[39m
[32m     27[39m warmup = blackjax.window_adaptation(blackjax.hmc,
[32m     28[39m                                     _logprob,
[32m     29[39m                                     num_integration_steps=num_integration_steps,
[32m     30[39m                                     progress_bar=verbose)
[32m     31[39m init_key, key = jr.split(key)
[32m---> [39m[32m32[39m (hmc_initial_state, hmc_params), _ = [43mwarmup[49m[43m.[49m[43mrun[49m[43m([49m[43minit_key[49m[43m,[49m[43m [49m[43minitial_unc_params[49m[43m,[49m[43m [49m[43mnum_steps[49m[43m=[49m[43mwarmup_steps[49m[43m)[49m
[32m     33[39m hmc_kernel = blackjax.hmc(_logprob, **hmc_params).step
[32m     35[39m [38;5;129m@jit[39m
[32m     36[39m [38;5;28;01mdef[39;00m[38;5;250m [39m[34mhmc_step[39m(hmc_state, step_key):

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/adaptation/window_adaptation.py:340[39m, in [36mwindow_adaptation.<locals>.run[39m[34m(rng_key, position, num_steps)[39m
[32m    338[39m keys = jax.random.split(rng_key, num_steps)
[32m    339[39m schedule = build_schedule(num_steps)
[32m--> [39m[32m340[39m last_state, info = [43mscan_fn[49m[43m([49m
[32m    341[39m [43m    [49m[43mone_step[49m[43m,[49m
[32m    342[39m [43m    [49m[43mstart_state[49m[43m,[49m
[32m    343[39m [43m    [49m[43m([49m[43mjnp[49m[43m.[49m[43marange[49m[43m([49m[43mnum_steps[49m[43m)[49m[43m,[49m[43m [49m[43mkeys[49m[43m,[49m[43m [49m[43mschedule[49m[43m)[49m[43m,[49m
[32m    344[39m [43m[49m[43m)[49m
[32m    346[39m last_chain_state, last_warmup_state, *_ = last_state
[32m    348[39m step_size, inverse_mass_matrix = adapt_final(last_warmup_state)

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/progress_bar.py:105[39m, in [36mgen_scan_fn.<locals>.scan_wrap[39m[34m(f, init, *args, **kwargs)[39m
[32m    103[39m func = progress_bar_scan(num_samples, print_rate)(f)
[32m    104[39m carry = (init, -[32m1[39m)
[32m--> [39m[32m105[39m (last_state, _), output = [43mlax[49m[43m.[49m[43mscan[49m[43m([49m[43mfunc[49m[43m,[49m[43m [49m[43mcarry[49m[43m,[49m[43m [49m[43m*[49m[43margs[49m[43m,[49m[43m [49m[43m*[49m[43m*[49m[43mkwargs[49m[43m)[49m
[32m    106[39m [38;5;28;01mreturn[39;00m last_state, output

    [31m[... skipping hidden 9 frame][39m

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/progress_bar.py:90[39m, in [36mprogress_bar_scan.<locals>._progress_bar_scan.<locals>.wrapper_progress_bar[39m[34m(carry, x)[39m
[32m     88[39m subcarry, chain_id = carry
[32m     89[39m chain_id = _update_progress_bar(iter_num, chain_id)
[32m---> [39m[32m90[39m subcarry, y = [43mfunc[49m[43m([49m[43msubcarry[49m[43m,[49m[43m [49m[43mx[49m[43m)[49m
[32m     92[39m [38;5;28;01mreturn[39;00m (subcarry, chain_id), y

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/adaptation/window_adaptation.py:310[39m, in [36mwindow_adaptation.<locals>.one_step[39m[34m(carry, xs)[39m
[32m    307[39m _, rng_key, adaptation_stage = xs
[32m    308[39m state, adaptation_state = carry
[32m--> [39m[32m310[39m new_state, info = [43mmcmc_kernel[49m[43m([49m
[32m    311[39m [43m    [49m[43mrng_key[49m[43m,[49m
[32m    312[39m [43m    [49m[43mstate[49m[43m,[49m
[32m    313[39m [43m    [49m[43mlogdensity_fn[49m[43m,[49m
[32m    314[39m [43m    [49m[43madaptation_state[49m[43m.[49m[43mstep_size[49m[43m,[49m
[32m    315[39m [43m    [49m[43madaptation_state[49m[43m.[49m[43minverse_mass_matrix[49m[43m,[49m
[32m    316[39m [43m    [49m[43m*[49m[43m*[49m[43mextra_parameters[49m[43m,[49m
[32m    317[39m [43m[49m[43m)[49m
[32m    318[39m new_adaptation_state = adapt_step(
[32m    319[39m     adaptation_state,
[32m    320[39m     adaptation_stage,
[32m    321[39m     new_state.position,
[32m    322[39m     info.acceptance_rate,
[32m    323[39m )
[32m    325[39m [38;5;28;01mreturn[39;00m (
[32m    326[39m     (new_state, new_adaptation_state),
[32m    327[39m     adaptation_info_fn(new_state, info, new_adaptation_state),
[32m    328[39m )

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/mcmc/hmc.py:143[39m, in [36mbuild_kernel.<locals>.kernel[39m[34m(rng_key, state, logdensity_fn, step_size, inverse_mass_matrix, num_integration_steps)[39m
[32m    138[39m momentum = metric.sample_momentum(key_momentum, position)
[32m    140[39m integrator_state = integrators.IntegratorState(
[32m    141[39m     position, momentum, logdensity, logdensity_grad
[32m    142[39m )
[32m--> [39m[32m143[39m proposal, info, _ = [43mproposal_generator[49m[43m([49m[43mkey_integrator[49m[43m,[49m[43m [49m[43mintegrator_state[49m[43m)[49m
[32m    144[39m proposal = HMCState(
[32m    145[39m     proposal.position, proposal.logdensity, proposal.logdensity_grad
[32m    146[39m )
[32m    148[39m [38;5;28;01mreturn[39;00m proposal, info

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/mcmc/hmc.py:303[39m, in [36mhmc_proposal.<locals>.generate[39m[34m(rng_key, state)[39m
[32m    301[39m delta_energy = safe_energy_diff(proposal_energy, new_energy)
[32m    302[39m is_diverging = -delta_energy > divergence_threshold
[32m--> [39m[32m303[39m sampled_state, info = [43msample_proposal[49m[43m([49m[43mrng_key[49m[43m,[49m[43m [49m[43mdelta_energy[49m[43m,[49m[43m [49m[43mstate[49m[43m,[49m[43m [49m[43mend_state[49m[43m)[49m
[32m    304[39m do_accept, p_accept, other_proposal_info = info
[32m    306[39m info = HMCInfo(
[32m    307[39m     state.momentum,
[32m    308[39m     p_accept,
[32m   (...)[39m[32m    313[39m     num_integration_steps,
[32m    314[39m )

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/blackjax/mcmc/proposal.py:227[39m, in [36mstatic_binomial_sampling[39m[34m(rng_key, log_p_accept, proposal, new_proposal)[39m
[32m    216[39m [38;5;28;01mdef[39;00m[38;5;250m [39m[34mstatic_binomial_sampling[39m(
[32m    217[39m     rng_key: PRNGKey, log_p_accept: [38;5;28mfloat[39m, proposal, new_proposal
[32m    218[39m ):
[32m    219[39m [38;5;250m    [39m[33;03m"""Accept or reject a proposal.[39;00m
[32m    220[39m 
[32m    221[39m [33;03m    In the static setting, the probability with which the new proposal is[39;00m
[32m   (...)[39m[32m    225[39m 
[32m    226[39m [33;03m    """[39;00m
[32m--> [39m[32m227[39m     p_accept = [43mjnp[49m[43m.[49m[43mclip[49m[43m([49m[43mjnp[49m[43m.[49m[43mexp[49m[43m([49m[43mlog_p_accept[49m[43m)[49m[43m,[49m[43m [49m[38;5;28;43mmax[39;49m[43m=[49m[32;43m1[39;49m[43m)[49m
[32m    228[39m     do_accept = jax.random.bernoulli(rng_key, p_accept)
[32m    229[39m     info = do_accept, p_accept, [38;5;28;01mNone[39;00m

    [31m[... skipping hidden 10 frame][39m

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/jax/_src/linear_util.py:192[39m, in [36mWrappedFun.call_wrapped[39m[34m(self, *args, **kwargs)[39m
[32m    189[39m gen = gen_static_args = out_store = [38;5;28;01mNone[39;00m
[32m    191[39m [38;5;28;01mtry[39;00m:
[32m--> [39m[32m192[39m   ans = [38;5;28;43mself[39;49m[43m.[49m[43mf[49m[43m([49m[43m*[49m[43margs[49m[43m,[49m[43m [49m[43m*[49m[43m*[49m[38;5;28;43mdict[39;49m[43m([49m[38;5;28;43mself[39;49m[43m.[49m[43mparams[49m[43m,[49m[43m [49m[43m*[49m[43m*[49m[43mkwargs[49m[43m)[49m[43m)[49m
[32m    193[39m [38;5;28;01mexcept[39;00m:
[32m    194[39m   [38;5;66;03m# Some transformations yield from inside context managers, so we have to[39;00m
[32m    195[39m   [38;5;66;03m# interrupt them before reraising the exception. Otherwise they will only[39;00m
[32m    196[39m   [38;5;66;03m# get garbage-collected at some later time, running their cleanup tasks[39;00m
[32m    197[39m   [38;5;66;03m# only after this exception is handled, which can corrupt the global[39;00m
[32m    198[39m   [38;5;66;03m# state.[39;00m
[32m    199[39m   [38;5;28;01mwhile[39;00m stack:

[31mTypeError[39m: clip() got an unexpected keyword argument 'max'

